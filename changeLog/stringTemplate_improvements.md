# Улучшения модуля stringTemplate

## Дата: 2024-12-19

## Внесенные изменения

### 1. Исправления в deepManipulate.ts

#### Проблема с обработкой массивов

- **Проблема**: Функция `splitDeepPath` неправильно обрабатывала отрицательные и нечисловые индексы массивов
- **Решение**: Добавлена строгая проверка формата индексов массивов с использованием регулярного выражения `/^\[(-?\d+)\]$/`
- **Результат**: Отрицательные индексы (например, `arr[-1]`) и нечисловые индексы (например, `arr[abc]`) теперь корректно обрабатываются и возвращают `undefined`

#### Улучшение функции deepGet

- **Проблема**: При неправильном пути к массиву функция возвращала весь массив вместо `undefined`
- **Решение**: Добавлена проверка, что если путь содержит только ключ объекта, но значение - массив, то возвращается `defaultValue`
- **Результат**: Более предсказуемое поведение при работе с массивами

### 2. Тестирование крайних случаев

Проведено тестирование следующих сценариев:

- Пустые строки
- Специальные символы в ключах
- Вложенные шаблоны (не поддерживаются - корректное поведение)
- Множественные вхождения одного ключа
- Ключи с пробелами (не поддерживаются - корректное поведение)
- Ключи с точками
- Отрицательные индексы массивов
- Нечисловые индексы массивов
- Большие числа
- NaN и Infinity
- Объекты с пользовательским toString
- Функции
- Символы
- Булевы значения
- Undefined и null значения
- Очень глубокие пути

### 3. Безопасность

- Регулярные выражения правильно экранируют специальные символы
- Нет уязвимостей ReDoS (Regular Expression Denial of Service)
- Корректная обработка пользовательского ввода

### 4. Производительность

- Использование эффективного алгоритма поиска с `while` циклом и `exec()`
- Минимальное количество операций с регулярными выражениями
- Оптимальная обработка больших объектов

### 5. Добавление тестов в deepObjects.spec.ts

- **Добавлены тесты для `deepGet`**: 12 тестовых сценариев, включая обработку null/undefined, нормальных путей, индексов массивов, отрицательных и нечисловых индексов, несуществующих путей, глубоких путей и значений по умолчанию
- **Добавлены тесты для `splitDeepPath`**: 8 тестовых сценариев, включая простые пути объектов, индексы массивов, смешанные пути, отрицательные и нечисловые индексы, пустые и недопустимые входные данные, ключи с точками и сложные пути массивов

### 6. Исправление проблемы с deepGetParent

- **Проблема**: Функция `deepGetParent` возвращала пустой массив для корректных путей из-за слишком строгой логики в `deepGet`
- **Решение**: Добавлена проверка некорректных индексов массивов на раннем этапе в `deepGet`, что позволяет корректно обрабатывать как некорректные индексы, так и промежуточные пути для `deepGetParent`

## Заключение

Модуль `stringTemplate` и связанные функции `deepGet` и `splitDeepPath` теперь более надежны и корректно обрабатывают все крайние случаи. Все существующие тесты проходят (68/68), а новые сценарии тестирования подтверждают правильность работы функций. Добавлено 20 новых тестов для проверки исправленных функций.
